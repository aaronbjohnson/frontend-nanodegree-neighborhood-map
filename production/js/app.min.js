var gmarkers=[],map,infowindow,marker,initialPlaces;initialPlaces=[{name:"Soda Bar",lat:40.678396,lng:-73.968349,pinID:0},{name:"Brooklyn Roasting Co.",lat:40.704334,lng:-73.986524,pinID:1},{name:"Prospect Park",lat:40.661034,lng:-73.968876,pinID:2},{name:"Brooklyn Public Library",lat:40.672371,lng:-73.968254,pinID:3},{name:"Brooklyn Museum",lat:40.671207,lng:-73.963619,pinID:4},{name:"Metropolitan Museum of Art",lat:40.779413,lng:-73.96326,pinID:5},{name:"Lexington Candy Shop",lat:40.777467,lng:-73.957295,pinID:6}];var initMap=function(){var a={center:{lat:40.722827,lng:-73.968343},zoom:12};map=new google.maps.Map(document.getElementById("map-canvas"),a),infowindow=new google.maps.InfoWindow;var b,c="develop/images/star.png";for(b=0;b<initialPlaces.length;b++)marker=new google.maps.Marker({position:new google.maps.LatLng(initialPlaces[b].lat,+initialPlaces[b].lng),title:initialPlaces[b].name,map:map,icon:c}),google.maps.event.addListener(marker,"click",function(a){return function(){map.panTo(a.position),infowindow.setContent(a.title+"<div id='content'></div>"),infowindow.open(map,a),apiRequest(a)}}(marker)),gmarkers.push(marker)},foursquareApi="https://api.foursquare.com/v2/venues/search?client_id=3P0CNNUW5YA1QIJAQUVRR0H4UI4FVASXURVLXGP4AOMAHXIM&client_secret=NJFWJLYRXMAHO2W2F1SIGOTA5LMHMSUTGLM2XBRAXV5YMUBM&v=20150401",googleStreetview="https://maps.googleapis.com/maps/api/streetview?size=300x150&location=",apiRequest=function(a){var b=a.position.lat(),c=a.position.lng(),d=$("#content"),e=foursquareApi+"&ll="+b+","+c+"&query='"+a.title+"'&limit=1";$.getJSON(e,function(a){var b=a.response.venues[0],c=b.contact.formattedPhone,e=b.location.formattedAddress,f=b.location.address,g=b.location.city,h=b.location.country,i=f+g+h,j=googleStreetview+i;c=void 0===c?"<i>Could not find phone number for this location<i>":c,d.append("<p>"+c+"</p>"),d.append("<p>"+e+"</p>"),d.append('<img class="street-img" src="'+j+'">')}).error(function(a){d.text("No information can be retrieved at this time.")})},ViewModel=function(){var a=this;a.placeList=ko.observableArray(initialPlaces),a.markers=ko.observableArray(gmarkers),a.filter=ko.observable(""),a.openWindow=function(a){var b=gmarkers[a.pinID],c=new google.maps.LatLng(a.lat,+a.lng);map.panTo(c),infowindow.open(map,b),infowindow.setContent(b.title+'<div id="content"></div>'),apiRequest(b)},a.toggleMarkers=function(a){for(var b=0;b<gmarkers.length;b++)gmarkers[b].setMap(a)},a.filterArray=function(b){return ko.utils.arrayFilter(a.placeList(),function(a){return a.name.toLowerCase().indexOf(b)>=0})},a.displaySelected=function(a){for(var b=0;b<a.length;b++)gmarkers[a[b].pinID].setMap(map)},a.filterList=function(){var b=a.filter().toLowerCase();if(b){a.toggleMarkers(null);var c=[];return c=a.filterArray(b),a.displaySelected(c),c}return a.toggleMarkers(map),a.placeList()}};google.maps.event.addDomListener(window,"load",initMap),ko.applyBindings(new ViewModel);