var map,infowindow,gmarkers=[],foursquareApi="https://api.foursquare.com/v2/venues/search?client_id=3P0CNNUW5YA1QIJAQUVRR0H4UI4FVASXURVLXGP4AOMAHXIM&client_secret=NJFWJLYRXMAHO2W2F1SIGOTA5LMHMSUTGLM2XBRAXV5YMUBM&v=20150401",googleStreetview="https://maps.googleapis.com/maps/api/streetview?size=300x150&location=",ViewModel=function(){var a=this;a.locations=ko.observableArray([{name:"Soda Bar",latitude:40.678396,longitude:-73.968349,pinId:0},{name:"Brooklyn Roasting Co.",latitude:40.704334,longitude:-73.986524,pinId:1},{name:"Prospect Park",latitude:40.661034,longitude:-73.968876,pinId:2},{name:"Brooklyn Public Library",latitude:40.672371,longitude:-73.968254,pinId:3},{name:"Brooklyn Museum",latitude:40.671207,longitude:-73.963619,pinId:4},{name:"Metropolitan Museum of Art",latitude:40.779413,longitude:-73.96326,pinId:5},{name:"Lexington Candy Shop",latitude:40.777467,longitude:-73.957295,pinId:6}]),a.markers=ko.observable(gmarkers),a.filter=ko.observable(""),a.apiRequest=function(a){"use strict";var b=a.position.lat(),c=a.position.lng(),d=$("#content"),e=foursquareApi+"&ll="+b+","+c+"&query='"+a.title+"'&limit=1";$.getJSON(e,function(a){var b=a.response.venues[0],c=b.contact.formattedPhone,e=b.location.formattedAddress,f=b.location.address,g=b.location.city,h=b.location.country,i=f+g+h,j=googleStreetview+i;c=void 0===c?"<i>Could not find phone number for this location<i>":c,d.append("<p>"+c+"</p>"),d.append("<p>"+e+"</p>"),d.append('<p class="credits">Venue information provided by Foursquare.<p>'),d.append('<img class="street-img" src="'+j+'">')}).error(function(a){d.text("No information can be retrieved at this time.")})},ko.bindingHandlers.googlemap={init:function(b,c){var d=c(),e={zoom:12,center:new google.maps.LatLng(d.centerLat,d.centerLon),mapTypeId:google.maps.MapTypeId.ROADMAP};map=new google.maps.Map(b,e),infowindow=new google.maps.InfoWindow;var f="develop/images/star.png";for(var g in d.locations()){var h=new google.maps.LatLng(d.locations()[g].latitude,d.locations()[g].longitude),i=new google.maps.Marker({position:h,map:map,title:d.locations()[g].name,icon:f});google.maps.event.addListener(i,"click",function(b){return function(){map.panTo(b.position),infowindow.setContent(b.title+"<div id='content'></div>"),infowindow.open(map,b),a.apiRequest(b)}}(i)),gmarkers.push(i)}}},a.openWindow=function(b){var c=(b.latitude,b.longitude,gmarkers[b.pinId]);infowindow.open(map,c),infowindow.setContent(c.title+'<div id="content"></div>'),a.apiRequest(c)},a.toggleMarkers=function(a){for(var b=0;b<gmarkers.length;b++)gmarkers[b].setMap(a)},a.filterArray=function(b){return ko.utils.arrayFilter(a.locations(),function(a){return-1!==a.name.toLowerCase().indexOf(b)})},a.displaySelected=function(a){for(var b=0;b<a.length;b++)gmarkers[a[b].pinId].setMap(map)},a.filteredItems=ko.computed(function(){var b=a.filter().toLowerCase();if(b){a.toggleMarkers(null);var c=[];return c=a.filterArray(b),a.displaySelected(c),c}return a.toggleMarkers(map),a.locations()},a)};ko.applyBindings(new ViewModel);